Title: Create a Global Cluster - MongoDB Atlas

URL: https://www.mongodb.com/docs/atlas/tutorial/create-global-cluster/

On this pageThis section covers enabling Global Writes on an Atlas cluster.To create to a Global Cluster, you must haveOrganization Owner or Project Owner access tothe project.Before creating a Global Cluster, reviewGlobal Clusters Overview andGlobal Clusters Sharding Reference.You can enable Global Writes in Atlas when you create an M30or greater sharded cluster.After you deploy the cluster, you can't convert a Global Clusterto a standard sharded cluster.Due to sharding requirements,you can't load sample data onto a Global Cluster.If this is the first dedicated paid cluster for the selected region orregions and you plan on creating one or moreVPC peering connections, review VPC Peering Connections before continuing.If it's not already displayed, select the organization thatcontains your desired project from the  Organizations menu in thenavigation bar.If it's not already displayed, select your desired projectfrom the Projects menu in the navigation bar.If it's not already displayed, click Clusters in thesidebar.The Clusters page displays.If you already have one or more clusters, clickCreate to display theCreate New Cluster dialog box.If this is your first cluster:Click Build a Database.Click advanced configuration options at the top ofthe screen to display theCreate New Cluster dialog box.In the Create New Cluster dialog box, selectthe Dedicated cluster type. For more information,see Create a Cluster.Click Global Cluster Configuration to expand thesection.Toggle Enable Global Writes (M30 and Up) toOn to display the Global Cluster configuration.By default, global clusters enable Atlas-Managed Shardingto automatically configure the shard keysand zones for the cluster.For each shard, Atlas creates a location field in the shard keyassociated with the corresponding zone so that Atlascan distribute data to shards based on geographic location.This option is recommended for most workloads.If you're an advanced user and the default configuration is too restrictivefor your workload, select Self-Managed Sharding.If you select this option, you must manually configure the shardingstrategy by using mongosh or a supported MongoDB Driver.To learn more about zone sharding, see Zones. To learn how to add shards to a zone,see Manage Zones.You can't change between Atlas-Managed Shardingand Self-Managed Sharding after you deploy the cluster.Each cloud provider has a selection of global regions to whichAtlas can deploy a zone. The choice of cloud provider maysupport or constrict your ability to deploy a zone to specificgeographic locations. The configuration options available andthe cost for running the cluster may also vary depending oncloud provider selection.Atlas provides three options for configuring yourGlobal Cluster zones:Configure Global Writes Zones Using a TemplateConfigure a Global Writes Single Region ZoneConfigure a Global Writes Multi Region ZoneSelect the appropriate tab based on how you would like to configureyour Global Cluster zones.Atlas provides two templates for configuring Global Writeszones for the cluster, each with a description of the purposeof its underlying configuration. Click on a template to viewthe Zone Map for that template. The Zone Map provides a visualdescription of the cluster zone configuration, includingestimates of geographic latency and coverage.Click Zone configuration summary below the zone mapto view a summary of each zone in the Global Cluster.Atlas provides the following validations for each zone:Indicates whether data in this zone is replicated toevery other zone for local secondary reads by clientsin those zones.Click the Configure Local Reads in AllZones button in the Zone configurationsummary to automatically configure every zone in thecluster for local reads.Indicates whether the zone supports high availability,such that a majority of electable nodes remain healthyand reachable in the event of a partial region outage.Regions marked as Recommendedin the Atlas UI support high availability duringpartial regional outages.To learn more, see the following pages:Amazon Availability Zones.GCP Zones.Azure Availability Zones.By default, each template deploys a series of single-regionzones and builds a map of country and subdivision locationsgeographically near each zone. MongoDB uses this location-zonemap to route read and write operations which containlocation data to the shardor shards in the corresponding zone.If you enabled Atlas-Managed Sharding,click Configure Location Mappings in the ZoneMap to view the list of location-zone mappings. To customizethe location-zone mapping, click the Zone dropdownfor a given Location Name and select a new zone.Click the Reset button to reset a custom mappingfor any given location. Click the Reset All Zonemappings button to reset all custom mappings for the cluster.You can make additional configuration changes to each zoneafter selecting a zone template. For instructions, see theSingle Region Zone tab.You can also create Multi-region zones. For instructions, seethe Multi-Region Zone tab. ClickingConfigure Local Reads in All Zones converts allzones to multi-region.Click View Zone Templates in the Zone Map to returnto the template selection.The Zone Configuration section allows you toconfigure each zone in your cluster. Atlas displays adrop-down box directly above the Zone Configurationthat indicates the currently selected zone. Click the+ Add a Zone button to add additional zones to theGlobal Cluster, up to a maximum of nine (9) zones. Ifyou require more than nine zones, contact Atlas support.The Zone Map updates as you modify each zone. If the Zone Mapcurrently displays the template selection menu, clickConfigure Zones Myself to view the Zone map.In the Zone Configuration section,click the Select the preferred region for your zonedrop-down box and select a region as the HighestPriority region for each shard assigned to the zone. Atlasbuilds a map of countries and subdivisions that aregeographically near the selected region. MongoDB uses thislocation-zone map to route read and write operations whichcontain location data to theshard or shards in the corresponding zone.If you enabled Atlas-Managed Sharding,click Configure Location Mappings in the Zone Mapto view the list of location-zone mappings. To customize thelocation-zone mapping, click the Zone dropdown fora given Location Name and select a new zone. Clickthe Reset button to reset a custom mapping for anygiven location. Click the Reset All Zone mappingsbutton to reset all custom mappings for the cluster.For each shard in the zone, Atlas distributes the shardnodes with respect to the Zone Configuration. Youcan add additional shards to the zone by clickingAdditional Options in the ZoneConfiguration section and selecting the total number of shardsin the zone from the drop-down box. By default, Atlasdeploys one shard per zone. Atlas recommends creatingadditional zones to support heavy write load in a geographicregion instead of adding multiple shards to a single zone.Atlas supports no more than 100 shards perGlobal Cluster.Selecting a zone template resets anyconfiguration changes made in the ZoneConfiguration section to the default for the selectedtemplate.The Zone Configuration section allows you toconfigure each zone in your cluster. Atlas displays adrop-down box directly above the Zone Configurationthat indicates the currently selected zone. Click the+ Add a Zone button to add additional zones to theGlobal Cluster, up to a maximum of nine (9) zones. Ifyou require more than nine zones, contact Atlas support.The Zone Map updates as you modify each zone. If the Zone Mapcurrently displays the template selection menu, clickConfigure Zones Myself to view the Zone map.Click theSelect Multi-Region, Workload Isolation and Replication Optionsbutton to display the multi-region configuration controls.Zones for which you toggled theConfigure Local Reads in All Zones in theZone configuration summary display the multi-regionzone controls by default.Electable nodes for high availabilityConfigure the Highest Priority andElectable nodes in the zone.Global Write Zones and Zone Mapping.If you add regions with electable nodes, you:increase data availability andreduce the impact of data center outages.You may set different regions from one cloud provider or choosedifferent cloud providers.Atlas sets the node in the first row of the Electable nodestable as the Highest Priority region.Atlas prioritizes nodes in this region for primary eligibility.Other nodes rank in the order that they appear. For more information,see Member Priority.Click Add a region to add a new row for regionselection and select the region from the dropdown. Specifythe desired number of Nodes for the region. Thetotal number of electable nodes across all regions in thezone must be 3, 5, or 7.Atlas builds a map of countries and subdivisionsgeographically near the selected region for theHighest Priority node. MongoDB uses thislocation-zone map to route read and write operations whichcontain location data tothe shard or shards in the corresponding zone.If you enabled Atlas-Managed Sharding,click Configure Location Mappings in the ZoneMap to view the list of location-zone mappings. To customizethe location-zone mapping, click the Zonedropdown for a given Location Name and select anew zone. Click the Reset button to reset acustom mapping for any given location. Click theReset All Zone mappings button to reset allcustom mappings for the cluster.Read-only nodes for optimal local readsConfigure the Read-only nodes in the zone. Eachrow represents one Region where Atlas deploysthe configured Number of Nodes of theRead-only Node Type.Click Add a region to add additionalRead-only rows. Consideradding Read-only nodes in each region where youwant to facilitate local secondary read operations.Analytics nodes for workload isolationUse analytics nodes to isolatequeries which you do not wish to contend with your operationalworkload. Analytics nodes help handle data analysis operations, such asreporting queries from BI Connector for Atlas. Analytics nodes havedistinct replica set tags which allow youto direct queries to desired regions.Click Add a region to select a region in which todeploy analytics nodes. Specify the desired number ofNodes for the region.For each shard in the zone, Atlas distributes the shardnodes with respect to the Zone Configuration. Youcan add additional shards to the zone by clickingAdditional Options in the ZoneConfiguration section and selecting the total number of shardsin the zone from the drop-down box. By default, Atlasdeploys one shard per zone. Atlas recommends creatingadditional zones to support heavy write load in a geographicregion instead of adding multiple shards to a single zone.Atlas supports no more than 100 shards perGlobal Cluster.Selecting azone templateresets any configuration changes made in theZone Configuration section to the default for theselected template.If you are using the standard connection string formatrather than the DNS seedlist format,removing an entire zone from an existing global cluster may resultin a new connection string.To verify the correct connection string after deploying the changes:In Atlas, go to the Clusters page for your project.If it's not already displayed, select the organization thatcontains your desired project from the  Organizations menu in thenavigation bar.If it's not already displayed, select your desired projectfrom the Projects menu in the navigation bar.If it's not already displayed, click Clusters in thesidebar.The Clusters page displays.Verify the connection string.Click Connect.To use Global Clusters, you must select a cluster tierthat is M30 or larger.The selected tier dictates the memory, storage, vCPUs, and IOPSspecification for each data-bearing server in thecluster.For more information on how to select an appropriate cluster tier andstorage settings for your workload, seeSelect Cluster Tier and Customize Cluster Storage.From the Additional Settings sectionfor Global Clusters, you can:Select the MongoDB Version of the ClusterConfigure Backup Options for the ClusterEnable BI Connector for AtlasManage Your Own Encryption KeysConfigure Additional OptionsThis is the cluster name as it appears in Atlas. You can'tchange the cluster name once Atlas deploys the cluster.Cluster names can't exceed 64 characters in length.Atlas truncates the cluster name to 23 characters inits internal interactions. In practice, this means:Cluster names shorter than 23 characters can't end withhyphen or dash (-).Cluster names 23 characters or longer can't use a hyphen ordash (-) as its 23rd character.The first 23 characters in a cluster name must be uniquewithin a project.Don't include sensitive information in yourcluster name.Proceed to checkout.Click Create Cluster below the form and complete thebilling information only if it doesn't already exist. If yourorganization already has the billing information, Atlas deploysyour cluster.Type the email address to which Atlas should sendbilling alerts.By default, Atlas sends billing alerts to the Organization Ownersand Billing Admins.If you leave the Billing Email Address blank,Atlas sends billing alerts to the Organization Owners and Billing Admins.If you specify a billing email address and uncheck Onlysend invoice emails to the Billing EmailAddress, Atlas sends billing alerts to the billingemail address, Organization Owners, and Billing Admins.If you specify a billing email address and check the box for Onlysend invoice emails to the Billing EmailAddress, Atlas send billing alerts to the billing email address only.Type or select the political subdivision in which your billingaddress exists. The label and field change depending on whatyou selected as your Country:If you select United States as your Country, thislabel changes to State. The field changes to a dropdownmenu of U.S. states. You can also start typing the name ofthe state and then select it from the filtered list ofstates.If you select Canada as your Country, this labelchanges to Province. The field changes to a dropdownmenu of Canadian provinces. You can also start typing thename of the province and then select it from the filteredlist of provinces.If you select any other country as your Country, thislabel changes to State/Province/Region. The fieldchanges to a text box. Type the name of your province,state, or region in this box.Atlas displays the VAT ID field if youselect a country other than the United States.To learn more about VAT, seeVAT ID.If your company's billing address is in a country other thanthe United States (USA), Atlas typically charges VAT if you donot enter a valid VAT ID Number on yourbilling profile.IMPORTANT: If your billing address is in Ireland or certainCanadian provinces, Atlas always charges VAT, even with a validVAT ID Number.To learn more about VAT by region, seeInternational Usage and Taxation.Click the radio button for Credit Card orPaypal.If you selected Credit Card, type values for thefollowing fields:CVCIf you selected PayPal:Click Pay with PayPal.Complete the actions on the PayPal website.All projects within your organization share the same billingsettings, including payment method.Under the Cart section, review the following:Deploy your cluster.Click Confirm and Deploy Cluster below the form to deploy yourcluster.Each Atlas project supports up to 25 clusters.Please contact Atlas support for questions or assistance regardingthe cluster limit. To contact support:In Atlas, go to the Project Support page.If it's not already displayed, select the organization thatcontains your desired project from the  Organizations menu in thenavigation bar.If it's not already displayed, select your desired projectfrom the Projects menu in the navigation bar.Next to the Projects menu, expand the Options menu, then clickProject Support.The Project Support page displays.Request support.If you selected Atlas-Managed Sharding, you canuse the Atlas UI to shard a collection for global writes.To learn more, see Shard a Global Collection.If you selected Self-Managed Sharding, you must manuallyconfigure the shard key and shard the global collection. To learn more,see Shard Keys andShard a Collection.Manage Global ClustersBackCreate a ClusterNextCloud Providers and RegionsOn this page